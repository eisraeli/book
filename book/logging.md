# RHTAP Logs

Logging is crucial for effective monitoring and troubleshooting.\
In the RHTAP environments, numerous clusters, components and services work together,
making it essential to have comprehensive logs which provide insights into their
behavior, allowing to understand and diagnose issues. Logging facilitates proactive
monitoring, enabling prompt detection of failures, abnormal behavior, or potential
security threats.\
Additionally, logs play a vital role in compliance and auditing, helping to meet
regulatory requirements and uncovering the root causes of incidents.\
Ultimately, effective logging practices contribute to enhanced operational efficiency,
streamlined troubleshooting, and maintaining a robust and secure environment.

## OpenShift Logs

[As described in the OpenShift Container Platform documentation](https://docs.openshift.com/container-platform/4.13/logging/cluster-logging.html),
the logging subsystem aggregates the following types of logs:

_**application**_ - Container logs generated by user applications running in the cluster,
except infrastructure container applications.

_**infrastructure**_ - Logs generated by infrastructure components running in the cluster
and OpenShift Container Platform nodes, such as journal logs. Infrastructure components
are pods that run in the openshift*, kube*, or default projects.

_**audit**_ - Logs generated by auditd, the node audit system, which are stored in the
/var/log/audit/audit.log file, and the audit logs from the Kubernetes apiserver and the
OpenShift apiserver.


## Splunk
[Splunk](https://splunk.com) is a widely used log management and analytics platform that
allows organizations to collect, index, search, analyze, and visualize machine-generated
data, including logs from various sources. Splunk provides powerful search capabilities,
real-time monitoring, alerting, and robust data visualization options.

For RHTAP, we use a Splunk Cloud, which is a cloud-based version of the Splunk platform.
It is being maintained by Splunk and Red Hat's IT Splunk team.

RHTAP's Splunk: https://rhcorporate.splunkcloud.com

### Logs retention in Splunk

#### Getting Access to the logs in Splunk
Each Splunk index has a Splunk role which is assosiated with a Rover group.\
By being added to a Rover group, a RHTAP member gains access to a Splunk index.
Rover groups owners are the ones who can add RHTAP members to the Rover groups.\
After being added to the Rover group(s), the related index can be accessed.

#### RHTAP Staging Environment

| Log type       | Splunk Index         | Rover Group                    |
|----------------|:--------------------:|-------------------------------:|
| application    | rh_rhtap_stage_app   | [staging-rhtap-application-logs](https://rover.redhat.com/groups/group/staging-rhtap-application-logs) |
| infrastructure | rh_rhtap_stage_audit | [staging-rhtap-audit-logs](https://rover.redhat.com/groups/group/staging-rhtap-audit-logs)       |
| audit          | rh_rhtap_stage_audit | [staging-rhtap-audit-logs](https://rover.redhat.com/groups/group/staging-rhtap-audit-logs)       |

#### RHTAP Production Environment

| Log type       | Splunk Index              | Rover Group                    |
|----------------|:-------------------------:|-------------------------------:|
| application    | rh_rhtap_production_app   | [staging-rhtap-application-logs](https://rover.redhat.com/groups/group/production-rhtap-application-logs) |
| infrastructure | rh_rhtap_production_audit | [staging-rhtap-audit-logs](https://rover.redhat.com/groups/group/production-rhtap-audit-logs)       |
| audit          | rh_rhtap_production_audit | [staging-rhtap-audit-logs](https://rover.redhat.com/groups/group/production-rhtap-audit-logs)       |


#### OpenShift Logging Configuration
https://github.com/redhat-appstudio/infra-deployments/tree/main/components/monitoring/logging

#### Secrets
Secrets are stored in [Vault](https://vault.devshift.net).

#### RHTAP Staging Environment
| Secret Name                                | Vault Path                |
|--------------------------------------------|:--------------------------|
| splunk-forwarder-rhtap-staging-application | [staging/monitoring/logging/fluentd/splunk-forwarder-rhtap-staging-application](https://vault.devshift.net/ui/vault/secrets/stonesoup/show/staging/monitoring/logging/fluentd/splunk-forwarder-rhtap-staging-application) |
| splunk-forwarder-rhtap-staging-audit       | [staging/monitoring/logging/fluentd/splunk-forwarder-rhtap-staging-audit](https://vault.devshift.net/ui/vault/secrets/stonesoup/show/staging/monitoring/logging/fluentd/splunk-forwarder-rhtap-staging-audit) |

___

#### RHTAP Production Environment
| Secret Name                                | Vault Path                |
|--------------------------------------------|:--------------------------|
| splunk-forwarder-rhtap-production-application | [production/monitoring/logging/fluentd/splunk-forwarder-rhtap-production-application](https://vault.devshift.net/ui/vault/secrets/stonesoup/show/production/monitoring/logging/fluentd/splunk-forwarder-rhtap-production-application) |
| splunk-forwarder-rhtap-production-audit       | [production/monitoring/logging/fluentd/splunk-forwarder-rhtap-production-audit](https://vault.devshift.net/ui/vault/secrets/stonesoup/show/production/monitoring/logging/fluentd/splunk-forwarder-rhtap-production-audit) |

* Secrets are also backed-up in the o11y team's BitWarden vault.

### Splunk Related Links
* [The Source - IT - Splunk](https://source.redhat.com/departments/it/splunk)
* [Open Shift Documentation - Cluster Logging](https://docs.openshift.com/container-platform/4.13/logging/cluster-logging.html)
* [Open Shift Cluster Logging Operator Github repository](https://github.com/openshift/cluster-logging-operator)

### Contact
RHTAP logs are being managed by the o11y team.\
The team can be reached on the following Slack channel:\
[#forum-rhtap-o11y](https://redhat-internal.slack.com/archives/C04FDFTF8EB)
